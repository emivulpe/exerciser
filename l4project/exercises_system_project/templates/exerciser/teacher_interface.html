{% extends 'exerciser/teacher_interface_base.html' %}


{% block style %}
.brand-heading{
	font-size: 36pt;
}

.success{
	color:green;
}

{% endblock %}
{% block body_block %}


	{% if user.is_authenticated %}
		<div class="container">
			<div class="row">
				<div class="col-md-4 text-center">
					<h1>Register a group</h1><br>
					<form id="register_group">
							<p><label for="year">Academic Year:</label> <select id="year" style="margin: 10px 5px 10px 10px; padding: 5px; font-size: 12pt; font-weight: bold;">
							{% for year in academic_years %}
								<option value="{{year.start}}" >{{ year.start}}/{{ year.start|add:"1" }}</option>
							{% endfor %}
						</select></p>
						<p><label for="group_id">Group ID:</label> <input type="text" name="group"></p>
						<p><label for="num_students">Number of Students:</label> <input id="num_students" type="number" min="0" name="num_students" onkeypress="return isNumber(event)"></p>
						<input id="register_group_button" type="reset" value="Register">

					</form>
					<br>
					<strong id="group_success_message"></strong>
				</div>
				<div class="col-md-4 text-center">
					<h1 class="brand-heading"><a href="/exerciser/statistics/"><i class="fa fa-bar-chart landing-icon fa-lg fa-5x"></i><br><br><span class="landing-text">View Statistics</span></a></h1>
				</div>
				<div class="col-md-4 text-center">
					<h1>View group list</h1><br>
					<form id="register_group">
						<p><label for="group">Group ID:</label> <select id="group" style="margin: 10px 5px 10px 10px; padding: 5px; font-size: 12pt; font-weight: bold;">
							{% for group in groups %}
								<option value="{{group.name}}" >Group {{group.name}}</option>
							{% endfor %}
						</select></p>
						<a id="get_group_list_link" class="btn btn-default"href="/exerciser/get_group_list/" >list</a>
						<input id="view_group_list" type="reset" value="View">
					</form>
					<br>
					<strong id="student_success_message"></strong>
				</div>
			</div>			
		</div>


	{% else %}
		<div class="container">
			<div class="row">
				<div class="col-md-6 text-center">
					{% if request.session.registered = True %}
						<br/><br/><br/><br/><br/>
						<div style="font-size: 12pt; font-weight: bold;"> 
							<i class="fa fa-check success" style="color:green;"></i>
							<strong class="success" style="color:green;">Thank you for registering! Please log in</strong>
						</div>
					{% elif request.session.registered = False %}

						<h1>Register here!</h1><br />
						
						<form id="user_form" method="post" action="/exerciser/register/" enctype="multipart/form-data">
							{% csrf_token %}

							<!-- Display each form. The as_p method wraps each element in a paragraph
							(<p>) element. This ensures each element appears on a new line,
							making everything look neater. -->
							{{ user_form.as_p }}
							{{ group_form.as_p }}

							<!-- Provide a button to click to submit the form. -->
							<input id="register_user_button" type="submit" name="submit" value="Register" />
						</form><br/>
						<div style="font-size: 12pt; font-weight: bold;"> 
							<i class="fa fa-close success" style="color:red;"></i>
							<strong class="success" style="color:red;">Your registration was unsuccessful. Please try again!</strong>
						</div>
					{% else %}
						<h1>Register here!</h1><br />

						<form id="user_form" method="post" action="/exerciser/register/" enctype="multipart/form-data">
							{% csrf_token %}

							<!-- Display each form. The as_p method wraps each element in a paragraph
							(<p>) element. This ensures each element appears on a new line,
							making everything look neater. -->
							{{ user_form.as_p }}
							{{ group_form.as_p }}

							<!-- Provide a button to click to submit the form. -->
							<input id="register_user_button" type="submit" name="submit" value="Register" />
						</form>
					{% endif %}
				</div>
				<div class="col-md-6 text-center">
					<h1>Login to Exerciser</h1>
					<form id="login_form" method="post" action="/exerciser/login/"><br>
						{% csrf_token %}
						<p><label for="id_username">Username:</label> <input id="id_username" maxlength="30" name="username" type="text"></p>
						<p><label for="id_password">Password:</label> <input id="id_password" name="password" type="password"></p>
						<input id="login_button" type="submit" value="Submit"/>
					</form>
					{% if request.session.successful_login = False %}
						<br/>
						<div style="font-size: 12pt; font-weight: bold;"> 
							<i class="fa fa-close success" style="color:red;"></i>
							<strong class="success" style="color:red;">Sorry but your attempt to login was unsuccessful! Please try again!</strong>
						</div>
					{% endif %}
				</div>
			</div>			
		</div>

	{% endif %}

{% endblock %}

{% block javascripts %}

	<script type="text/javascript" src="/static/js/cookieAccessor.js"></script>

	<script>
		var csrftoken = getCookie('csrftoken');
		$('button').each(function(){
			$(this).closest('form').find("input[type=text], textarea").val("");
			console.log("DA");
			$("#id_username").val('');
		});
		
		$('#register_group').submit(function(e) {
			e.preventDefault();	
		});
		
		
		$('#get_group_list_button').click(function () {
			request = $.post("/exerciser/get_group_list/",{
					csrfmiddlewaretoken : csrftoken,
			});
		});
		
		$('#register_group_button').click(function () {
			console.log("click");
			var chosen_group = $('input:text[name=group]').val();
			var num_students = $('#num_students').val();
			var year=document.getElementById("year").value;

			console.log("{{ user.username }}");
			console.log(num_students+"num");
			//var request;
			//var chosen_option="";
			//if(option=="group"){
				request = $.post("/exerciser/create_group/",{
					csrfmiddlewaretoken : csrftoken,
					teacher : "{{ user.username }}",
					group : chosen_group,
					year : year,
					num_students : num_students
				});
				//chosen_option = " group " + chosen_name;
			//}
			/*else{
				request = $.post("/exerciser/create_student/",{
					csrfmiddlewaretoken : csrftoken,
					teacher : "{{ user.username }}",
					student : chosen_name
				});
				chosen_option = " student " + chosen_name;
			}*/
			request.done(function(test) {
				if( $(".success_icon").length ){
					$( ".success_icon" ).remove();
				}
				console.log(test);
				if (test){
					$("#group_success_message").before("<i class='fa fa-check success_icon' style='color:green'></i>");
					$("#group_success_message").text(" You successfully created group " + chosen_group + "!");
					$("#group_success_message").css("color","green");
					$("#group").append("<option value='"+chosen_group+"' >Group "+ chosen_group + "</option>");
				}
				else{
					$("#group_success_message").before("<i class='fa fa-times success_icon' style='color:red'></i>");
					$("#group_success_message").text("Sorry but the chosen group " + chosen_group + " already exists. Please choose another name!");
					$("#group_success_message").css("color","red");
				}
			});
		});
		
		
		$('#view_group_list').click(function () {

			var chosen_group = document.getElementById("group").value;
			var variables="?group="+chosen_group+"&teacher={{ user.username }}&year=2014";
			window.location="/exerciser/get_group_list"+variables;
		});

function isNumber(evt){
    var charCode = (evt.which) ? evt.which : event.keyCode
    if (charCode > 31 && (charCode < 48 || charCode > 57))
        return false;
    return true;
}  
	</script>
{% endblock %}